%% LQR Script - ATP-XW Blizzard

% Author: Jack Comey
% Student ID: 915323775

%% Preamble

format short eng

%% Code

% Its not optimizing because there is no gravity.

m = 2200;
I = [500 10 10;
     10 500 10;
     10 10 500;];

A = [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0;  % x
     0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0;  % y
     0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0;  % z
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % x'
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % y'
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % z'
     0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0;  % phi
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0;  % theta
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1;  % psi
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % phi'
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % theta'
     0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0;  % psi'
     ];
 
%  A = [0 0; 1 0];

 
B1 = [0, 0, 0, 0, 0, 0, 0, 0;  % x'
     0, 0, 0, 0, 0, 0, 0, 0;  % y'
     0, 0, 0, 0, 0, 0, 0, 0;  % z'
     0, 0, 0, 0, 0, 0, 0, 0;  % x''
     0, 0, 0, 0, 0, 0, 0, 0;  % y''
     -1, -1, -1, -1, -1, -1, -1, -1;  % z''
     0, 0, 0, 0, 0, 0, 0, 0;
     0, 0, 0, 0, 0, 0, 0, 0;
     0, 0, 0, 0, 0, 0, 0, 0;
     2, -2, 2, -2, 2, -2, 2, -2;
     2.5, 2.5, -2.5, -2.5, 2.5, 2.5, -2.5, -2.5;
     -1, 1, 1, -1, 1, -1, -1, 1;
     ];

B2 = [0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 1/m 0 0 0 0 0 0 0 0; % Fx
     0 0 0 0 1/m 0 0 0 0 0 0 0; % Fy
     0 0 0 0 0 1/m 0 0 0 0 0 0; % Fz
     0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 0 0 0 0 0 0 0 0 0;   % 0
     0 0 0 0 0 0 0 0 0 1/I(1,1) 0 0;   % Mx
     0 0 0 0 0 0 0 0 0 0 1/I(2,2) 0;   % My
     0 0 0 0 0 0 0 0 0 0 0 1/I(3,3);]; % Mz

 B2(10:12, 10:12) = inv(I);

% B = [0 0; 1/m 0];
 
B = B2 * B1

 Q = eye(12);
 R = 1 .* eye(8);
%  R = m .* eye(12);
 C = eye(12);
 D = zeros(size(B));
 
sys = ss(A, B, C, D);
K = lqr(A, B, Q, R);

K = -K;

for i = 1:12
    for j = 1:12
        if K(i, j) < 1E-10
            K(i, j) = 0;
        end
    end
end

disp(K)

writematrix(K, "K.csv")